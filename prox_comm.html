
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Proximity communication &#8212; pyenki  documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Changelog" href="changelog.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyenki  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="proximity-communication">
<h1>Proximity communication<a class="headerlink" href="#proximity-communication" title="Permalink to this headline">¶</a></h1>
<p>A Thymio can enable proximity communication and transmits an integer payload every 0.1 s.
The message is received by other Thymios if they have enabled proximity communication too and if at least one of their proximity sensors
is visible by one of the emitter’s [proximity] LEDs.</p>
<div class="section" id="run-time">
<h2>Run-time<a class="headerlink" href="#run-time" title="Permalink to this headline">¶</a></h2>
<p>At each control step, the simulation collect neighbors’ messages sent after the last control step
into <a class="reference internal" href="api.html#pyenki.Thymio2.prox_comm_events" title="pyenki.Thymio2.prox_comm_events"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pyenki.Thymio2.prox_comm_events</span></code></a>.</p>
<p>Note that each message is broadcasted only for 1 control step.
Therefore if the duration of a control step (i.e. the period at which messages are received)
is shorter than 0.1 (i.e. the period at which messages are sent),
for some control steps the robot will receive no message.</p>
<p>This mimic the behavior of the real robot that will receive short pulses of IR light sent by a neighbor every 0.1 seconds.
One minor difference is that the real robots tries to avoid collision between their IR pulses by moving
slightly the timing of their emission in the 0.1 second long time-window. On the contrary, the simulated robots,
sent the messages immediately before the next control step and their messages do not incur into collisions.</p>
</div>
<div class="section" id="simulated-response">
<h2>Simulated Response<a class="headerlink" href="#simulated-response" title="Permalink to this headline">¶</a></h2>
<p>More precisely, given an emitting [proximity] LED at point <span class="math notranslate nohighlight">\(p_e\)</span> and angle <span class="math notranslate nohighlight">\(\alpha_e\)</span> and a receiving [proximity] sensor at point <span class="math notranslate nohighlight">\(p_r\)</span> and angle <span class="math notranslate nohighlight">\(\alpha_r\)</span>,
a pulse from <cite>e</cite> to <cite>r</cite> is visible if the following criteria are met:</p>
<ol class="arabic simple">
<li><p>the distance between <span class="math notranslate nohighlight">\(p_e\)</span> and <span class="math notranslate nohighlight">\(p_r\)</span> is less then  <span class="math notranslate nohighlight">\(\rho\)</span> ~ 23 cm,</p></li>
<li><p><cite>p_r</cite> is inside the circular sector [<span class="math notranslate nohighlight">\(\alpha_e\)</span> - <span class="math notranslate nohighlight">\(\beta_e\)</span>, <span class="math notranslate nohighlight">\(\alpha_e\)</span> + <span class="math notranslate nohighlight">\(\beta_e\)</span>] centered at <span class="math notranslate nohighlight">\(p_e\)</span>, with <span class="math notranslate nohighlight">\(\beta_e\)</span> ~ 15 degrees (0.268 rad),</p></li>
<li><p><cite>p_e</cite> is inside the circular sector [<span class="math notranslate nohighlight">\(\alpha_r\)</span> - <span class="math notranslate nohighlight">\(\beta_r\)</span>, <span class="math notranslate nohighlight">\(\alpha_r\)</span> + <span class="math notranslate nohighlight">\(\beta_r\)</span>] centered at <span class="math notranslate nohighlight">\(p_r\)</span>, with <span class="math notranslate nohighlight">\(\beta_r\)</span> ~ 36 degrees (0.644 rad),</p></li>
<li><p>there are no obstacles along the segment <span class="math notranslate nohighlight">\(\overline{p_r p_e}\)</span>.</p></li>
</ol>
<p>The light intensities of all emitters <span class="math notranslate nohighlight">\(e\)</span> are summed up and stimulate a noisy response <span class="math notranslate nohighlight">\(r\)</span> :</p>
<div class="math notranslate nohighlight">
\[r \approx \frac{m}{\frac{1}{\sum_e \frac{c-x_0^2}{(|p_r - p_e|-x_0)^2}} + 1}\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> ~ 4200 is the maximal value, <span class="math notranslate nohighlight">\(x_0\)</span> ~ 0.02 cm is a small offset and <cite>c</cite> ~ 275 <span class="math notranslate nohighlight">\(\textrm{cm}^2\)</span> is a bias</p>
<p>We set to 0 all responses not large enough (i.e., lower than the response caused by an emitter at distance <span class="math notranslate nohighlight">\(\rho\)</span>).
Note that this is still a simplification because we ignore that the real intensities depends also on the orientations.</p>
<p>Each received message in encoded as an <a class="reference internal" href="api.html#ircommevent"><span class="std std-ref">IRCommEvent</span></a> <code class="docutils literal notranslate"><span class="pre">event</span></code>, where <code class="docutils literal notranslate"><span class="pre">event.payloads</span></code> and <code class="docutils literal notranslate"><span class="pre">event.intensities</span></code> contain the response of the seven proximity sensors:
the first five entries are from frontal sensors ordered from left to right and the last two entries are from rear sensors ordered from left to right.
When a sensor doesn’t receive the message (i.e., when the response is too weak), the corresponding payload and intensity are set to zero.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Proximity communication</a><ul>
<li><a class="reference internal" href="#run-time">Run-time</a></li>
<li><a class="reference internal" href="#simulated-response">Simulated Response</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="changelog.html"
                        title="previous chapter">Changelog</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.html"
                        title="next chapter">Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/prox_comm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyenki  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Stéphane Magnenat and others.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>